---
output:
  # bookdown::word_document2:
    # reference_docx: "word-template.docx"
  bookdown::pdf_document2:
    toc: no
    number_sections: no
    pandoc_args: !expr rmdfiltr::add_wordcount_filter(rmdfiltr::add_citeproc_filter(args = NULL))
    latex_engine: xelatex
always_allow_html: true
header-includes:
# - \usepackage{setspace}\doublespace
  # - \usepackage{endnotes}
  # - \let\footnote=\endnote
  # - \usepackage{endfloat}
- \setlength{\headheight}{14.5pt}
#- \setlength{\headheight}{13.6pt}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \lhead{N.I. Hoffmann}
- \rhead{`r format(Sys.time(), '%B %e, %Y')`}
- \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{A\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{A\arabic{figure}}}

editor_options: 
  chunk_output_type: console

citeproc: no
fontfamily: mathpazo
fontsize: 12pt
geometry: margin=1in
indent: yes
link-citations: yes
linkcolor: blue
lang: 'en-US'

bibliography: "/Users/nathan/Documents/My Library.bib" 
# bibliography: "My Library.bib"  
csl: apa.csl
# csl: american-sociological-association.csl

title: "Strangers in the Homeland? The Academic Performance of Children of Return Migrants in Mexico"
# subtitle: "ASA 2022 Submission"
author: |
  | Nathan I. Hoffmann
  | Department of Sociology, UCLA
date: "`r format(Sys.time(), '%B %e, %Y')`"

abstract: "The number of return migrants from the U.S. to Mexico has swelled in recent years, and yet we know little about the academic performance of the over 500,000 U.S.-born children who have accompanied them. This paper harnesses PISA test score data to compare U.S.-born children of return migrants in Mexico to two groups: Mexican-born students in Mexico, and students in the U.S. born to Spanish-speaking immigrant parents. Contrary to much previous work highlighting the academic struggles faced by children of return migrants, these adolescents attain higher PISA scores than their Mexican-born counterparts. However, these adolescents' scores are much lower than similar youths in the U.S. Results for either comparison change little in models controlling for variables related to immigrant selection, and they vary little by possible individual moderators. Overall, these findings suggest that these often forcibly displaced adolescents quickly assimilate to the relatively low educational standards of Mexican schools, highlighting the importance of institutional factors in the incorporation process."

  

  
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = T)
options("yaml.eval.expr" = TRUE)

# library(flextable)
library(patchwork)
library(srvyr)
library(patchwork)
library(cem)
library(sandwich)
library(lmtest)
library(estimatr)
library(here)
library(knitr)
library(kableExtra)
library(broom)
library(sensemakr)
library(MatchIt)
library(haven)
library(tidyverse)

knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})


options("yaml.eval.expr" = TRUE, scipen = 3, digits = 2)

uclablue = '#2774AE'
gray = '#808080'
black = '#000000'
ucla_palette = c(black, uclablue, gray)

# theme_set(theme_cowplot(font_family = 'Palatino') + 
theme_set(theme_classic(base_family = 'Palatino') + 
      theme(legend.title=element_blank(), 
         panel.grid.major.y = element_line('grey80'),
         legend.background = element_rect(fill = alpha("white", 0.5))
         ))
ggplot <- function(...) ggplot2::ggplot(...) + 
  scale_color_brewer(palette="Dark2") +
  scale_fill_brewer(palette="Dark2")

kable <- function(...) knitr::kable(..., format.args = list(big.mark = ","))
```

```{r load, include = F}
pisa_full <- readRDS(here('data', 'pisa.rds')) %>%
   filter(across(c(female,  mom_ed, dad_ed, early_ed, cultural_pos, home_ed, age),
                ~ !is.na(.x))) %>%
  mutate(school_id = paste0(year, school_id),
         village = school_location == 'Village',
         non_urban = ifelse(!is.na(school_location), school_location %in% c('Village', 'Small Town', 'Town'), NA))

pisa_mex <- pisa_full %>%
  filter(country == 'Mexico',
         birth_country %in% c('Mexico', 'United States of America'),
         mom_country == 'Mexico',
         dad_country == 'Mexico') %>%
  mutate(birth_country = ifelse(birth_country == 'United States of America', 'USA', as.character(birth_country)),
         treat = as.numeric(birth_country == 'USA'))

pisa_us <-  pisa_full %>%
  filter((country %in% c('United States', 'United States of America') & 
            birth_country == 'United States of America' &
            lang == 'Spanish' &
            mom_country == 'Another country (USA)' & 
            dad_country == 'Another country (USA)')) %>%
  mutate(country = 'USA',
         birth_country = 'USA')

pisa_mex_us <- bind_rows(
    filter(pisa_mex, birth_country == 'USA'),
    pisa_us
) %>%
  mutate(treat = as.numeric(country == 'Mexico'))


pisa_full %>%
  filter(country == 'Mexico',
         birth_country == 'United States of America',
         mom_country == 'Mexico', dad_country == 'Mexico') %>%
  mutate(birth_country = ifelse(birth_country == 'United States of America', 'USA', as.character(birth_country)),
         treat = as.numeric(birth_country == 'USA')) %>%
  nrow()
```

```{r functions}
rubin <- function(dataset, sample_label, covariates = NULL, pv_num = 5, 
                  treat = 'treat', weights = 'weight', cluster_var = 'school_id'){
  dataset = as.data.frame(dataset)
  dim_list <- list()
  method = ifelse(is.null(covariates), 'DIM', 'OLS')
  
  for(outcome in c('read', 'math', 'scie')){
    est_ols <- rep(NA, pv_num)
    var_ols <- rep(NA, pv_num)
    for(pv in 1:pv_num){
      if(is.null(covariates)){
        formula <- paste0(outcome, pv, ' ~ ', treat)
        } else{
          formula <- paste0(outcome, pv, ' ~ ', treat, ' + ', covariates)
        }
      lm_model <- lm(formula, data = dataset, weights = weight)
      est_ols[pv] <- tidy(lm_model)[[2,2]]
      var_ols[pv] <- vcovCL(lm_model, cluster = dataset[, cluster_var])[2,2]
      #var_ols[pv] <- vcovHC(lm_model, type="HC1")[2,2]
    }
    est_out_ols <- mean(est_ols)
    var_samp_ols <- mean(var_ols)
    var_imp_ols <- sum((est_ols - est_out_ols)^2)/4
    se_out_ols <- sqrt(var_samp_ols + (1 + 1/5)*var_imp_ols)
    
    dim_list[[outcome]] <-
      data.frame(method = method,
                 sample = sample_label,
                 Outcome = outcome, 
                 Estimate = est_out_ols,
                 se = se_out_ols)
  }
  dim_list %>%
    bind_rows() %>%
    mutate(Outcome = recode_factor(Outcome,
                                 'read' = 'Reading',
                                 'math' = 'Math',
                                 'scie' = 'Science')) %>%
    return()
}

moderator_p <- function(df, cat1, cat2){
  out_list <- list()
  for(outcome in unique(df$Outcome)){
    b1 <- with(df, Estimate[sample == cat1 & Outcome == outcome])
    se1 <- with(df, se[sample == cat1 & Outcome == outcome])
    b2 <- with(df, Estimate[sample == cat2 & Outcome == outcome])
    se2 <- with(df, se[sample == cat2 & Outcome == outcome]) 
    
    z <- (b1 - b2)/sqrt(se1^2 + se2^2)
    p <- round(2*(1 - pnorm(abs(as.numeric(z)))), 3)
    
    out_list[[outcome]] <- data.frame(Outcome = outcome, dif = b1-b2, z = z, p = p)
  }
  return(bind_rows(out_list))
}
  
  

rubin_means <- function(dataset, labels = c(0,1), pv_num = 5, 
                  treat = 'treat', weights = 'weight', cluster_id = 'school_id'){
  dataset <- as_survey_design(dataset, 
                              ids = cluster_id,
                              weights = weights)
  mean_list <- list()
  
  for(outcome in c('read', 'math', 'scie')){
    mean_treat0 <- rep(NA, pv_num)
    mean_treat1 <- rep(NA, pv_num)
    var_treat0 <- rep(NA, pv_num)
    var_treat1 <- rep(NA, pv_num)
    
    for(pv in 1:pv_num){
      
      summary_df <- dataset %>%
        group_by(treat) %>%
        summarize(mean = survey_mean(!!sym(paste0(outcome, pv))),
                  var = survey_var(!!sym(paste0(outcome, pv))))
      
      mean_treat0[pv] <- summary_df[[1,2]]
      mean_treat1[pv] <- summary_df[[2,2]]
      
      var_treat0[pv] <- summary_df[[1,4]]
      var_treat1[pv] <- summary_df[[2,4]]
      
    }
    mean_out0 <- mean(mean_treat0)
    var_samp0 <- mean(var_treat0)
    # var_imp0 <- sum((mean_treat0 - mean_out0)^2)/4
    # sd_out0 <- sqrt(var_samp0 + (1 + 1/5)*var_imp0)
    sd_out0 <- sqrt(var_samp0)
    
    mean_out1 <- mean(mean_treat1)
    var_samp1 <- mean(var_treat1)
    # var_imp1 <- sum((mean_treat1 - mean_out1)^2)/4
    # sd_out1 <- sqrt(var_samp1 + (1 + 1/5)*var_imp1)
    sd_out1 <- sqrt(var_samp1)
    
    mean_list[[outcome]] <-
      data.frame(Outcome = outcome, 
                 label = c(labels[1], labels[2]),
                 n = c(nrow(filter(dataset, treat==0)), nrow(filter(dataset, treat==1))),
                 Mean = c(mean_out0, mean_out1),
                 SD = c(sd_out0, sd_out1)
                 )
  }
  mean_list %>%
    bind_rows() %>%
    mutate(Outcome = recode_factor(Outcome,
                                 'read' = 'Reading',
                                 'math' = 'Math',
                                 'scie' = 'Science')) %>%
    return()
}


stacked_bar <- function(data, x, fill){
  data %>%
    filter(!is.na(!!sym(x)) & !is.na(!!sym(fill))) %>%
    count(!!sym(x), !!sym(fill)) %>%
    ggplot(aes(x = !!sym(x), y = n, fill = !!sym(fill))) +
    geom_bar(position='fill', stat = 'identity') +
    theme(axis.text.x = element_text(angle = -30)) +
    labs(title = fill)
}

```



<!-- Despite decades of research into migration flows between Mexico and the U.S., the migration process of children -- including return and circular migration -- is only recently receiving concerted scholarly attention. A flurry of theoretical work on return and circular migrant children in Mexico has followed the calls of @orellana_2001_transnational and @dobson_2009_unpacking to center children in migration research.  -->


<!-- **Notes for the Migration Working Group**: Thanks for reading my paper! I welcome any and all feedback and suggestions. I'm especially interested in how well my theoretical discussion works, whether the hypotheses are helpful, and whether the presentation of results is clear. I'm also wondering if I'm stretching the term "0.5 generation" too much from its original meaning, and if I should just call these students "U.S.-born children of return migrants." I'm hoping to send this to either a generalist sociology or demography journal, and I'm curious which you think is more appropriate.  -->

<!-- \setcounter{page}{52} -->

# Introduction

<!-- Despite an abundance of research on return migration, few studies focus on children of returnees. @azose_2019_estimation estimate that the greatest number of return migrants in the world are from the United States to Mexico.  -->

Due to both rising deportations and economic recession [@durand_2019_evolution], 1.3 million Mexican migrants in the U.S. made the journey back to Mexico between 2010 and 2015, making it the largest return migration flow in the world [@azose_2019_estimation]. American-born children of these Mexican return migrants now constitute a sizable population in Mexico, exceeding 500,000, or 2 percent of school enrollment [@masferrer_2021_return, p. 39]. Although these children have begun to receive scholarly attention, we know little about their educational outcomes at the national level. Results from ethnographic and interview studies have been mixed, with the majority emphasizing the struggles that these children face in adapting to school in Mexico. Many of these studies describe difficulty with written language, invisibility to teachers, and stigma and exclusion from other youths [@zuniga_2018_generation; @zuniga_2018_ninas; @zuniga_2021_children; @hamann_2006_pensando; @hernandez-leon_2020_imperfect; @despagne_2019_adaptation; @bybee_2020_estamos; @meyers_2014_outsiders; @bybee_2020_estamos]. But not all research depicts these adolescents as strangers in their homeland. @despagne_2019_adaptation find that, over time, these children are able to reposition themselves, capitalizing on their binational and bicultural assets to succeed in school. Other scholars recount that, despite these youths' challenges in adjusting to daily life in Mexico, teachers characterize them as "star students" in their academic achievement [@bybee_2020_estamos]. 
<!-- Following Víctor Zúñiga and colleagues [-@zuniga_2018_generation; @zuniga_2018_ninas; @zuniga_2021_children], I refer to these children as the "0.5 generation": children of Mexican immigrants who are born in the U.S. and later migrate to Mexico.   -->
<!-- Assimilation theory might predict a smooth transition, and yet a difficult "context of exit" [@silver_2018_displaced] may hamper this incorporation? Do the expectations of assimilation theory for a smooth transition bear out on a national level,  -->

In addition to this intriguing divergence in empirical studies, these U.S.-born migrants raise a number of theoretical questions for studies of immigrant incorporation. What does it mean to assimilate into a society where ethnic, cultural, and legal barriers are at a minimum? How does incorporation play out when the immigrant appears part of the mainstream? Does a difficult "context of exit" outweigh a favorable "context of return" [@silver_2018_displaced]? Because Mexico lacks national standardized testing [@santibanez_2021_contrasting], we do not know whether the educational situation of U.S.-born children of Mexican return migrants is generally one of advantage or disadvantage. Large-scale, nationally representative data are needed to evaluate the typical experience of these students. Furthermore, if disparities exist, we do not know whether this is due to the challenges of migration or a process of selection of which families choose or are forced to migrate back to Mexico.  

To help answer these questions, this paper relies on the Program for International Student Assessment (PISA) to characterize the educational achievement of U.S.-born children of return migrants in Mexico. PISA assesses 15-year-olds’ reading, math, and science skills every three years in dozens of countries worldwide [@schleicher_2019_pisa]. This paper uses these data to make two sets of comparisons. First, to assess the degree of integration or assimilation into their ancestral society, I compare U.S.-born children of return migrants to local non-migrants. Second, I estimate how these children's academic trajectories might have progressed had their parents not return-migrated, comparing these children to a similar, counterfactual group in the U.S. I also investigate the selection of return migrant parents and assess how it may impact their children's achievement. <!-- how the educational situation of the 0.5 generation has changed over time.-->  

I find that previous studies have overstated the academic challenges faced by children of return migrants in Mexico. Compared to Mexican adolescents, the U.S.-born among them perform as well or better on PISA tests. These effect estimates are nearly identical in models that do or do not control for pre- and post-migration attributes. Furthermore, these effects vary little by gender, locality, or age at migration. On the other hand, these adolescents obtain much lower scores than similar adolescents in the U.S. Although selection into migration accounts for some of the gap, disparities remain in models that adjust for this. Adolescents in Mexican rural areas obtain especially low scores, on average, compared to counterparts in the U.S. These results indicate overwhelming educational assimilation: counterfactual estimates suggest that moving to Mexico results in an immediate fall in PISA scores to just above the relatively low average. In an institutional context characterized by under-resourced Mexican schools [@santibanez_2021_contrasting], rapid educational assimilation weakens these adolescents' educational standing.

<!-- By presenting results from both sides of the border side by side, this paper paints a complicated picture. On the one hand, these adolescents retain some educational advantage compared to their Mexican-born peers. Bicultural resources, greater familiarity with standardized tests, the prestige of experience in the U.S. may help bolster their PISA scores. But the starker trend is of educational assimilation: counterfactual estimates suggest that moving to Mexico results in an immediate fall in PISA scores to just above the relatively low levels. In the context of under-resourced Mexican schools [@santibanez_2021_contrasting], rapid educational assimilation weakens their educational standing.   -->

This paper makes three larger contributions. First, it highlights the prime importance that institutional factors can assume in the assimilation process [@midtboen_2022_navigating; @crul_2003_second; @schneider_2022_new]. Results vary little across individual attributes, implying that larger institutional forces common to the full sample -- such as the Mexican school system -- play the main role in facilitating rapid educational assimilation. Second, this paper builds on the legacy of segmented assimilation theory [@portes_1993_new] and other work highlighting the downsides of rapid assimilation [e.g. @valenzuela_1999_subtractive]; rapid assimilation may not be a desirable outcome in many contexts. Finally, this paper pushes for consideration of an increasingly significant group in Mexico and other countries of emigration: foreign-born children of return migrants.


<!-- These findings suggest that conclusions about the 0.5 generation depend heavily on the choice of reference group and showcase the strength of the dissimilation framework. Although these children struggle on PISA compared to their U.S. counterparts, they tend to perform as well or better than their Mexican classmates. In this sense, they are assimilating to the relatively low educational average of the under-resourced Mexican school system [@santibanez_2021_contrasting]. -->



# Research Context
The Mexico-U.S. migration system has changed dramatically in the 21st century [@durand_2019_evolution]. After decades of high migration from Mexico to the U.S., the number of Mexican immigrants in the U.S. peaked at 12.8 million in 2007 and has declined since, numbering 11.4 million in 2019 [@gonzalez-barrera_2021_covid19]. This net negative migration is due both to lower rates of entry and rising rates of return [@durand_2019_evolution]. Pew estimates that from 2005 to 2010, 1.39 million Mexican immigrants returned to Mexico from the U.S., and 710,000 returned between 2013 and 2018 [@gonzalez-barrera_2021_covid19].

The bulk of return flows has been undocumented immigrants. From 2010 to 2018, 2.6 million undocumented Mexican immigrants returned to Mexico [@warren_2020_reverse]. A rapid increase in deportations is responsible for a large part of this outflow [@durand_2019_evolution, p. 37], but @warren_2020_reverse highlights that 45 percent of undocumented Mexican immigrants returned voluntarily. Precarious economic conditions in the U.S. and a stabilizing Mexican economy have increased incentives to return [@gonzalez-barrera_2021_covid19].  

As economic conditions and U.S. immigration policy have changed, so has the composition of Mexican return migrants. @campos-vazquez_2012_selfselection find a shift from positive to negative selection when compared to the full Mexican population: in 1990, return migrants had more years of schooling and higher wages than their stay-at-home compatriots, whereas in 2010 they tended to have less schooling and earn lower wages. @parrado_2016_changing argue that the lower wages of return migrants in 2010 compared to 1990 and 2000 are due to the less voluntary nature of return migration in recent years, and they also find decreases in entrepreneurship and the ability to remain inactive. For deportees, accumulation of valuable skills and capital is cut short [@cassarino_2004_theorising]. Using data from 2011 to 2013, @diaz_2016_moving show that negative selection also characterizes comparisons to Mexican immigrants who stay in the U.S.; for example, return migrants are less likely to possess a high school or college degree.  

Children are virtually absent from most discussions of return migration, yet their numbers are significant. In 2000, the Mexican census counted 258,000 U.S.-born minors; by 2010, this had more than doubled to 570,000 [@masferrer_2019_immigrants]. This number has remained steady in the years since: the 2020 Mexican census reports that 500,600 minors, or about 2 percent of the school-age population, were born in the U.S. [@masferrer_2021_return, p. 39].  

Although quantitative work remains scarce, qualitative researchers have begun to study these youths. Early work conceptualizing "(transnational) sojourner students" [@hamann_2001_theorizing; @hamann_2006_pensando] led to a large-scale survey in Nuevo León, Zacatecas, Puebla, and Jalisco to identify hundreds of students who had been born or had spent significant time in the U.S. [@zuniga_2018_ninas]. This research team dubs this population the "0.5 generation." Like the "1.5 generation" label for children who migrate at a young age [@portes_2001_legacies], "0.5 generation" foregrounds liminality; they cannot be easily grouped with either the native-born "0 generation" or the "first generation" of migrants more broadly, and this in-betweenness contributes to their particular challenges navigating an education system and society that feels both familiar and foreign.^[Under the "0.5 generation" label, Zúniga and colleagues also include minors born in Mexico who migrated to the U.S. at an early age and later returned, while this paper focuses only on those born in the U.S.]

<!-- regardless of their place of birth, these children have experience abroad but currently reside in the country of their parents' birth. -->
<!-- Noticing that Mexican adult respondents in Georgia often held plans to return to Mexico with their children -- many of them U.S.-born -- Hamann [-@hamann_2001_theorizing, p. 32] defined a new category, "sojourner student," whose "two defining characteristics are their vulnerability to dislocation and their transnational background."  -->

The findings from the studies by Zúñiga, his colleagues, and other researchers working in this domain have been mixed. Most of this work emphasizes the difficulties that the 0.5 generation faces in the Mexican "homeland." Despite usually possessing oral proficiency in both Spanish and English, their written competency often lags behind [@gonzalez_2016_moving; @despagne_2019_adaptation; @gandara_2020_students; @santibanez_2021_contrasting]. Especially when they first arrive, their peers often treat them as outsiders [@meyers_2014_outsiders], and the stigma they face can be exacerbated by the political climate, such as the 2016 election [@bybee_2020_estamos]. Conflicts also occur psychologically, as these children struggle with their identity and feelings of belonging [@despagne_2019_adaptation; @bybee_2020_estamos]. Yet their appearance and oral fluency often renders them invisible to teachers [@sanchezgarcia_2016_educator], and resources for immigrant students are lacking in Mexico [@santibanez_2021_contrasting]. Even navigating the complicated bureaucracy to enroll in school or finding the money for transportation, uniforms, and school supplies may be out of reach for return migrant families [@gandara_2020_students; @mateos_2019_mestizo]. Furthermore, family separation is a frequent, stressful feature of migration that is common for the 0.5 generation as well [@gonzalez_2016_moving; @zuniga_2018_generation; @masferrer_2019_immigrants]. These factors are compounded by the harsh immigration regime in the U.S. that encourages and forces the departure of these families [@waldinger_2021_transnational].  

The generally negative selection of migrant parents may further compound their children's disadvantage. Observing which migrant families both voluntarily and involuntarily return to Mexico, Hernández-León et al. [-@hernandez-leon_2020_imperfect, p. 94] suggest that "U.S. policies [...] effectively externalize downward assimilation to communities of origin." Migrants who return to Mexico from the U.S. may be those having the roughest time in the host country; hence their children are a selected group, more likely to struggle in the homeland due to disadvantage accrued before return. Furthermore, less-educated migrant parents are less likely to find lucrative work and more likely to be targeted for deportation, so controlling for family background may narrow disparities.  

Yet not all work on children of return migrant conceives of them as consigned to disadvantage. @zuniga_2018_ninas and @hernandez-leon_2020_imperfect see some of the children in their studies benefiting from dual nationality. Similarly, in an intensive ethnography in two schools in central Mexico, Bybee et al. [-@bybee_2020_estamos, p. 135] observe a "star student" discourse: "The notion of American-Mexican pupils as 'good students' was common enough in both schools that it extended beyond English classes where they had an obvious advantage." Although these students experienced bullying and exclusion due to their perceived foreignness, the privilege of binational education and other resources gave some of them a leg up in school.  


<!-- ## Theories of Return Migration -->

<!-- How can we understand the mixed results from previous studies of the 0.5 generation in Mexico? Work on the 0.5 generation has not fully engaged with theories of return migrant integration more broadly, yet these theories can help explain both positive and negative outcomes of their U.S.-born children. In an influential review, @cassarino_2004_theorising attempts to synthesize theories of return migration. Early neoclassical economic theory assumes that return migration marks a failure to achieve one's goals [@todaro_1980_internal], resulting in economically disadvantaged return migrants. On the other hand, the New Economics of Labor Migration (NELM) considers return migration as evidence of *success* [@stark_1985_new]: when a migrant saves or remits adequate funds, return may be the next step in a long-term plan. Hence families of return migrants may enjoy economic advantage. Structural theories, on the other hand, suggest that institutional opportunities in the country of origin matter too: return happens when these appear hospitable [@cerase_1974_expectations].   -->

<!-- Transnationalism breaks the origin-destination dichotomy present in the other theories by conceiving of return migration as part of a circular system [@portes_1999_study; @basch_1994_nations]. Migrants often feel connected by common ethnicity to a multipolar diaspora, developing identity with the host and home countries. Upon return, they may experience alienation and marginalization, strengthening their transnational identities. Finally, network theorists do not view ties between migrants as given, as transnationalists often do, but shaped by strategic linkages and interpersonal experiences. Varying degrees of network embeddedness are possible, and social structure shapes returnees' success in their initiatives.   -->

<!-- In his resource mobilization-preparedness framework, @cassarino_2004_theorising attempts to integrate these theories and more explicitly incorporate forced return. Resource mobilization refers to the tangible and intangible resources (including social capital) that a person gains during the migration experience, while preparedness encompasses a migrant's readiness and willingness to return. Migrants who are prepared to return *and* have acquired significant resources while abroad are likely to succeed in the home country. On the other hand, migrants who mobilize few resources and are not prepared for return -- as is often the case with deportees -- are more susceptible to economic hardship and marginalization in the home country.   -->

<!-- Despite its strength in explaining both positive and negative return outcomes, Cassarino's theory does not develop a role for origin-country context. In their review of sociological studies of return migration, @hagan_2020_return make a corrective: "We argue that reintegration pathways of return migrants depend not only on (a) the accumulation of resources and (b) readiness for return, as argued by Cassarino, but also on (c) sending state, institutional, and family contexts of reception and (d) opportunities to mobilize resources in local economies to which migrants return." In an origin context that stigmatizes return migrants, or where the institutions for capital and skill investment are insufficient, the children that accompany them are likely to suffer, regardless of individual resources.   -->

<!-- Finally, scholarship of return migration has done little to engage with broader theories of immigrant integration. Yet children of return migrants constitute a fascinating test case for assimilation theory. Alba and Nee [-@alba_2003_remaking, p. 11] define assimilation as "the decline of an ethnic distinction and its corollary cultural and social differences." In this case, distinctions are virtually absent from the start. Gone are most markers of social difference, including cultural, ethnic, and legal. Similarly, Portes and his collaborators [@portes_1993_new; @portes_2001_legacies; @portes_2014] suggest that assimilation occurs most smoothly when immigrants are free from racial discrimination and other social markers of difference, a large coethnic community exists, and government policy is relatively favorable (e.g., immigrants are not given unfavorable legal statuses). Here, these all hold; birth and experience abroad are the only salient factors distinguishing immigrants from "natives." Virtually free from cultural and legal barriers, does an immigrant status still make a difference to these adolescents' education? The theories of Portes and colleagues and Alba and Nee suggest that, without such barriers, assimilation will proceed smoothly. And yet previous studies document many struggles. This paper aims to rectify this apparent contradiction. -->


<!-- The implicit assumption is that, as natives of the society to which they return, return migrants -->


<!-- Studies of immigrant integration often attempt to disentangle individual from institutional factors that affect the trajectories of immigrants. Theories of assimilation suggest that without legal and cultural barriers, assimilation should be easy. So why does previous qualitative work on the 0.5 generation show significant struggles in school? -->


<!-- # Empirical Expectations -->

<!-- How can we understand the mixed results from previous studies of children of return migrants in Mexico? Theories of return migrant integration point to possible explanations for both positive and negative outcomes of their U.S.-born children. First, they help us understand possible *disadvantage*. The perspective of neoclassical economics suggests that return migrant families may not found lucrative employment in the host country [@todaro_1980_internal]. Even in cases where they have, a transnationalist perspective [@portes_1999_study; @basch_1994_nations] emphasizes that alienation and exclusion in the "home" society can still afflict return migrants and their children as they struggle with their identities. Institutions for investment and activation of resources gained in the U.S. may also be lacking [@hagan_2020_return, p. 539]. In addition, migrants who are not ready and willing to migrate [@cassarino_2004_theorising] -- as in the case of deportation, which accounts for 55 percent of all return migrations to Mexico [@warren_2020_reverse] -- are less likely to possess the resources to ease re-entry into Mexican society. The result can be traumatic for children, and may give rise to the difficulties documented in the ethnographic research cited above. These expectations lead to what I call the *rough re-entry hypothesis*:   -->

<!-- > Children of return migrants score lower on academic assessments than the comparison groups.  -->

<!-- Yet these students may also be among the privileged in Mexico. The New Economics of Labor Migration [@stark_1985_new] highlights how voluntary return migration can be evidence of economic success, with parents accumulating sufficient resources to lead a comfortable life in Mexico. Following Cassarino's [-@cassarino_2004_theorising] resource mobilization-preparedness framework, if children benefit from resource-rich social networks and parents who have achieved their goals in acquiring skills and capital while abroad, and if the family is ready and willing to move, they are more likely to be well supported upon return to the parents' country of origin. Scholars suggest that at least some of these children benefit from resources such as dual nationality, bicultural facility, and experience in better resourced schools [@gandara_2021_students]. Furthermore, in the absence of most social markers of difference, assimilation theory predicts that integration should be straightforward and rapid [@alba_2003_remaking; @portes_1993_new]. Referencing the "star student discourse" documented by @bybee_2020_estamos, the *star student hypothesis* predicts the following:   -->

<!-- > Children of return migrants score higher on academic assessments than the comparison groups.  -->




<!-- These frameworks help explain the variety of experiences that children in the 0.5 generation might have. First, they help us understand possible *disadvantage* for the 0.5 generation. The perspective of neoclassical economics suggests that return migrant families may not found lucrative employment in the host country. Even in cases where they have, the transnationalist perspective emphasizes that alienation and exclusion in the "home" society can still afflict return migrants and their children as they struggle with their identities [@despagne_2019_adaptation; @bybee_2020_estamos]. Institutions for investment and activation of resources gained in the U.S. may also be lacking [@hagan_2020_return, p. 539]. In addition, migrants who are not ready and willing to migrate -- as in the case of deportation -- are less likely to possess the resources to ease re-entry into Mexican society. The result can be traumatic for children, and may give rise to the difficulties documented in the ethnographic research cited above. These expectations lead to what I call the *rough re-entry hypothesis*: -->

<!-- > Compared to Mexican-born children in Mexico, children of return migrants attain lower PISA scores.   -->

<!-- Yet the 0.5 generation may also be among the privileged in Mexico. The NELM perspective highlights how voluntary return migration can be evidence of economic success, with parents accumulating sufficient resources to lead a comfortable life in Mexico. Following Cassarino's theory, if children benefit from resource-rich social networks and parents who have achieved their goals in acquiring skills and capital while abroad, and if the family is ready and willing to move, they are more likely to be well supported upon return to the parents' country of origin. Scholars suggest that at least some of these children benefit from resources such as dual nationality, bicultural facility, and experience in better resourced schools [@gandara_2021_students]. Furthermore, in the absence of most social markers of difference, assimilation theory predicts that integration should be straightforward and rapid [@alba_2003_remaking; @portes_1993_new]. Referencing the "star student discourse" documented by @bybee_2020_estamos, the *star student hypothesis* predicts the following: -->

<!-- > Compared to Mexican-born children in Mexico, children of return migrants attain higher PISA scores.   -->



<!-- > Compared to unadjusted models, adjusting for family background and resources produces smaller estimates of disparities than the comparison groups. -->


<!-- If the rough re-entry hypothesis is correct, then these students' challenges may be connected to return-migrant selection. For return migrants from the U.S. to Mexico, negative selection on characteristics such as education and income has predominated in recent years [@campos-vazquez_2012_selfselection; @parrado_2016_changing]. Observing which migrant families both voluntarily and involuntarily return to Mexico, Hernández-León et al. [-@hernandez-leon_2020_imperfect, p. 94] suggest that "U.S. policies [...] effectively externalize downward assimilation to communities of origin." Migrants who return to Mexico from the U.S. may be those having the roughest time in the host country; hence their children are a selected group, more likely to struggle in the homeland due to disadvantage accrued before return. Furthermore, less-educated migrant parents are less likely to find lucrative work and more likely to be targeted for deportation, so controlling for family background may narrow disparities. I call this third set of expectations the *selection hypothesis*: -->

<!-- > Compared to children of Spanish-speaking immigrants in the U.S., children of return migrants in Mexico attain lower PISA scores. However, in models adjusting for family background and resources, this disparity diminishes. -->


# Theory

## Individual Explanations

How can we understand the mixed results from previous studies of children of return migrants in Mexico? Theories of return migrant integration point to possible explanations for both positive and negative outcomes of their U.S.-born children. First, they help us understand possible *disadvantage*. The perspective of neoclassical economics suggests that return migrant families may not found lucrative employment in the host country [@todaro_1980_internal]. Even in cases where they have, a transnationalist perspective [@portes_1999_study; @basch_1994_nations] emphasizes that alienation and exclusion in the "home" society can still afflict return migrants and their children as they struggle with their identities. Institutions for investment and activation of resources gained in the U.S. may also be lacking [@hagan_2020_return, p. 539]. In addition, migrants who are not ready and willing to migrate [@cassarino_2004_theorising] -- as in the case of deportation, which accounts for 55 percent of all return migrations to Mexico [@warren_2020_reverse] -- are less likely to possess the resources to ease re-entry into Mexican society. The result can be traumatic for children, and may give rise to the difficulties documented in the ethnographic research cited above.  

Yet these students may also be among the privileged in Mexico. The New Economics of Labor Migration [@stark_1985_new] highlights how voluntary return migration can be evidence of economic success, with parents accumulating sufficient resources to lead a comfortable life in Mexico. Following Cassarino's [-@cassarino_2004_theorising] resource mobilization-preparedness framework, if children benefit from resource-rich social networks and parents who have achieved their goals in acquiring skills and capital while abroad, and if the family is ready and willing to move, they are more likely to be well supported upon return to the parents' country of origin. Scholars suggest that at least some of these children benefit from resources such as dual nationality, bicultural facility, and experience in better resourced schools [@gandara_2021_students]. Furthermore, in the absence of most social markers of difference, assimilation theory predicts that integration should be straightforward and rapid [@alba_2003_remaking; @portes_1993_new]. As @bybee_2020_estamos document, these U.S.-born children of return migrants may be "star students."


## Institutional Explanations

Individual resources or encumbrances may not be as important as the institutional context in which these children find themselves. In recent years, scholars of immigrant incorporation have found that institutional features of national systems may be at least as important as individual factors in accounting for incorporation outcomes [@thomson_2007_second; @crul_2003_second; @schneider_2022_new; @midtboen_2022_navigating; @platt_2022_which]. Scholars have deemed a research framework that homes in on government policy and educational systems an "institutional approach" [@thomson_2007_second, @vermeulen_2010_segmented] or (comparative) "integration context theory" [@crul_2016_superdiversity; @crul_2010_comparative]. When schools are well resourced and give students many opportunities for "second chances," immigrant-origin students tend to benefit [@midtboen_2022_navigating; @dronkers_2016_educational; @entorf_2008_peer; @heath_2008_second]. If schools are not accommodating of students of different backgrounds, or these students are concentrated in under-resourced schools, they tend to suffer [@valenzuela_1999_subtractive; @dronkers_2007_school; @borgna_2014_migrant]. Institutional features may also affect different types of migrant-origin students in different ways [@crul_2013_superdiversity; @crul_2016_superdiversity].  

Features of the Mexican education system suggest that children the return migrants may be especially ill-served. Although the U.S. education system has many weaknesses, the Mexican system is far worse resourced. In 2014, Mexico spent 2,000 USD per pupil, while the U.S. spent 18,000 USD [@santibanez_2021_contrasting, p. 25]. Even when adjusted for purchasing power parity, this funding difference results in fewer resources for learning. The school day is short (4.5 hours in elementary and 7 hours in secondary school), few extracurricular or enrichment programs exist, and many teachers in Mexico must navigate hectic hours, shifting between schools and sets of students in the middle of the schoolday [@santibanez_2021_contrasting]. There are also virtually no accommodations for children learning Spanish as a foreign language [@despagne_2019_adaptation]. All of these strains are likely to lower student achievement.  

## Analytic Approach

For the 0.5 generation, how do we define "positive" or "negative" outcomes in school? Much depends on the comparison group and estimand [@lundberg_2021_what]. The default comparison group for nearly all studies of immigrant education are locals without a migration background. Such a comparison is useful because it alerts policymakers and educators to disparities that can have lasting impacts on inequality. Yet such a perspective neglects immigrant selection. As discussed above, the composition of Mexican return migrants has transformed dramatically in the face of changing economics and immigration policy in the U.S. Such immigrant selection has important implications for the education of their children. Feliciano [-@feliciano_2005_does; @feliciano_2017_immigrant] shows that the children of immigrants with more education than their stay-at-home compatriots -- i.e., those who are "positively selected" -- tend to attain more schooling. Yet we know little about the impact of immigrant selection on children's schooling in the context of return migration.  

Immigrant selection can be incorporated into statistical models of children's education in two ways. It can be directly included as a covariate measuring relative educational attainment, at either the group [@feliciano_2005_does] or individual [@feliciano_2017_immigrant] level. Alternatively, the researcher can find a suitable comparison group that implicitly accounts for immigrant selection. For example, @hoffmann_2022_winwin compares young Eastern European migrants in Western Europe to similar co-nationals who stayed behind in the East. This second approach has the benefit of accounting for more than measured educational selectivity: many skills are not captured by measures of formal education [@hagan_2015_skills], and immigrants are selected in ways not related to skills at all. Further adjustment for observed individual differences can render the groups even more comparable.    

This paper makes both types of comparisons. First, it places U.S.-born children of Mexican return migrants in the Mexican educational context by comparing them to local Mexican children without migration backgrounds, providing an estimate of the descriptive gap in achievement between locals and U.S.-born children of return migrants. This set of analyses follows the tradition of assimilation literature, showing how similar to locals these migrant children have become. Second, this study compares these children to a suitable group across the border: Spanish-speaking children of immigrants in the U.S. The target here is a causal estimand: the scores these children would have obtained in the U.S. had they not migrated to Mexico. Finally, this paper explicitly examines immigrant selection by comparing and incorporating attributes of parents of these children in Mexico and the U.S. By considering both the U.S. and Mexico, this paper employs a cross-border perspective [@waldinger_2017_crossborder] that sheds greater light on the process and outcomes of migration than a single-country analysis would.


# Data and Methods

Data for the results below come from the pooled 2012, 2015, and 2018 waves of PISA. As shown in Table \@ref(tab:stats), the sample of interest comprises `r count(filter(pisa_mex, birth_country == 'USA'))` children in Mexico who were born in the U.S. to two Mexican-born parents. I compare these to `r count(filter(pisa_mex, birth_country == 'Mexico'))` children born in Mexico to two Mexican-born parents as well as `r nrow(pisa_us)` children born to two Spanish-speaking immigrant parents in the U.S. Although PISA data for the U.S. do not include exact country of birth for parents, about two-thirds of the Hispanic population in the U.S. is of Mexican origin [@trevelyan_2016_characteristics, p. 12], rendering this an appropriate pseudo-control group.^[Previous studies show similar achievement among U.S.-born children of Spanish-speaking immigrants from a variety of origins. Using data from the Immigration and Intergenerational Mobility in Metropolitan Los Angeles (IIMMLA) survey and Children of Immigrants Longitudinal Study (CILS-III) for San Diego, Rumbaut [-@rumbaut_2008_coming, p. 222] finds that the high school grades of second-generation Mexican, Salvadoran, and Guatemalan students are very similar. Similarly, models by @glick_2007_academic show that in the Early Childhood Longitudinal Study, third-grade math scores for children of Mexican, Puerto Rican, and other Hispanic origin are indistinguishable.]  

Outcome variables consist of reading, math, and science scores, which the OECD constructs to have a global mean of 500 and standard deviation of 100. I use the first five plausible values for reading, math, and science scores, combining estimates and calculating standard errors as suggested by the PISA Technical Reports.^[Although the 2015 and 2018 waves of PISA contain 10 plausible values, the 2012 data contains only 5. In pooled analysis of these different test years, I follow @teltemann_2020_standardized and @jerrim_2017_global in using five plausible values for all tests.]    

Pre-migration control variables include mother's and father's education (measured in 6-category ISCED, entered as a continuous variable in regressions), cultural possessions, home educational resources, age, a categorical variable for early childhood education and care (ECEC), survey year, and two-category gender. I also consider post-migration variables as possible mediators. These include composite variables constructed by the OECD which I standardize to have a mean of 0 and standard deviation of 1 within waves: household wealth, home possessions, home information and communication technology (ICT) resources, and an index of economic, social and cultural status. I also include highest parental occupational status measured in the International Socio-Economic Index [@ganzeboom_1992_standard] and a dichotomous measure of urban locality, with one category for small and large cities and another for villages, small towns, and towns.  

I present difference-in-means and OLS regression estimates comparing children of Mexican return migrants to both the Mexican and U.S. comparison samples. I incorporate pre-migration and post-migration attributes in turn as covariates in the OLS regressions to examine selection and integration processes. I also test the influence of the potential moderators of gender, rural/urban location, and age at migration by performing OLS regressions on subsets of the data. In all analyses, I cluster HC1 standard errors at the school level and incorporate final sampling weights.




<!-- This paper also explicitly examines immigrant selection by comparing and incorporating attributes of parents of these children in Mexico and the U.S. For return migrants from the U.S. to Mexico, negative selection on characteristics such as education and income has predominated in recent years [@campos-vazquez_2012_selfselection; @parrado_2016_changing]. Observing which migrant families both voluntarily and involuntarily return to Mexico, Hernández-León et al. [-@hernandez-leon_2020_imperfect, p. 94] suggest that "U.S. policies [...] effectively externalize downward assimilation to communities of origin." Migrants who return to Mexico from the U.S. may be those having the roughest time in the host country; hence their children are a selected group, more likely to struggle in the homeland due to disadvantage accrued before return. But there has been little investigation of whether  -->

<!-- These results quantify the phenomenon of "dissimilation": while assimilation refers to a process of becoming more similar to locals, dissimilation describes how immigrants become different from those they left behind [@fitzgerald_2012_comparativist].  -->



<!-- For the Mexican-born sample, I also perform coarsened exact matching (CEM) using the automatic coarsening algorithm from the `cem` package in R [@iacus_2012]. The U.S. comparison sample is too small for coarsened exact matching. -->


```{r stats}
bind_rows(
  rubin_means(pisa_mex, labels = c('Mexico', 'U.S.')) %>%
    mutate(Country = 'Mexico') %>%
    select(Outcome, `Country of Residence` = Country, `Birth Country` = label, n, Mean, SD),
  rubin_means(pisa_mex_us, labels = c('U.S.', 'Mexico')) %>%
    filter(label == 'U.S.') %>%
    mutate(`Birth Country` = 'U.S.') %>%
    select(Outcome, `Country of Residence` = label, `Birth Country`, n, Mean, SD)
  ) %>%
  select(-SD) %>% 
  pivot_wider(names_from = Outcome, values_from = Mean) %>%
  # flextable::flextable() %>%
  # flextable::set_caption('Sample sizes and PISA score means') %>%
  # flextable::add_footer_lines('Source: PISA data for 2012, 2015, and 2018. Author\'s calculations. The Mexico country, U.S. birth country sample includes only children of Mexican immigrants. The U.S. country, U.S. birth country sample includes only children born to Spanish-speaking immigrant parents. Mean estimates incorporate sampling weights and account for clustering within schools.') %>%
  # flextable::autofit() %>%
  # flextable::fit_to_width(7.5)
  kable(booktabs = T, linesep = "",
        caption = 'Sample sizes and PISA score means. The Mexico country, U.S. birth country sample includes only children of Mexican immigrants. The U.S. country, U.S. birth country sample includes only children born to Spanish-speaking immigrant parents. Mean estimates incorporate sampling weights and account for clustering within schools.') %>%
  footnote(general = 'PISA data for 2012, 2015, and 2018. Author\'s calculations.',
           general_title = 'Source:',
           threeparttable = T,
           footnote_as_chunk = T)
  
  # df %>%
#   arrange(Outcome) %>%
#   pivot_wider(names_from = 'Outcome', values_from = c('Mean', 'SD')) %>%
#   flextable() %>%
#   add_header_row(colwidths = c(3,2,2,2), values = c('', 'Reading', 'Math', 'Science'))
  
  
  # bind_rows(
  # pisa_mex %>%
  #   group_by(country, birth_country) %>%
  #   summarize(n = n(),
  #             Reading = mean(read1),
  #             `Reading SD` = sd(read1),
  #             Math = mean(math1),
  #             `Math SD` = sd(math1),
  #             Science = mean(scie1),
  #             `Science SD` = sd(scie1)),
  # pisa_us %>%
  #   group_by(country, birth_country) %>%
  #   summarize(n = n(),
  #             Reading = mean(read1),
  #             `Reading SD` = sd(read1),
  #             Math = mean(math1),
  #             `Math SD` = sd(math1),
  #             Science = mean(scie1),
  #             `Science SD` = sd(scie1))) %>%
  # rename(`Birth Country` = birth_country,
  #        Country = country) %>%
```


# Results

## Comparisons Within the Mexican Context

The first set of analyses compares children of return migrants to local children in Mexico. Table \@ref(tab:stats) presents sample sizes, mean scores, and standard deviations for the three samples. Although mean scores for all groups in the table are below the global average of 500, U.S.-born children in Mexico tend to score somewhat higher than Mexican-born children, especially in math.  



```{r models, include = F, results = 'hide'}
dim_fig_mex_us <-
  bind_rows(rubin(pisa_mex, 'DIM'),
          rubin(pisa_mex, 'OLS (pre-migration)', 'mom_ed + dad_ed + female + early_ed +cultural_pos + home_ed + age + year'),
          rubin(pisa_mex, 'OLS (pre- & post-migration)',
                covariates = 'mom_ed + dad_ed + female + early_ed +
                cultural_pos + home_ed + age + year + non_urban +
                wealth + home_pos + ict_res + escs + parent_isei')
) %>%
  mutate(Outcome = recode_factor(Outcome,
                                 'read' = 'Reading',
                                 'math' = 'Math',
                                 'scie' = 'Science'),
            sample = factor(sample, 
                            levels = c('DIM', 'OLS (pre-migration)', 'OLS (pre- & post-migration)')))


```

```{r dim-mex, results = 'hide', fig.height = 3.5, fig.cap = "Difference-in-means (DIM) and OLS estimates comparing children of return migrants in Mexico to children in Mexico. Error bars represent 95% asymptotic confidence intervals. OLS (pre-migration) models adjust for parents' education, cultural possessions, home educational resources, age, ECEC, gender, and survey year. OLS (post-migration) models additionally adjust for household wealth; home possessions; home ICT resources; an index of economic, social and cultural status; urban or non-urban locality; and highest parental ISEI. All models cluster standard errors at the school level and incorporate sampling weights."}
dim_fig_mex_us %>%
  ggplot(aes(x = sample, y = Estimate, color = Outcome)) +
  geom_point(position = position_dodge(0.2)) +
  geom_errorbar(aes(ymin = Estimate - 1.96*se, ymax = Estimate + 1.96*se),
                width = 0, alpha = 1, position = position_dodge(0.2)) +
  geom_hline(yintercept = 0) +
  labs(x = '', y = 'Estimated difference in PISA score') +
  theme(#axis.text.x=element_text(angle=-15),
        legend.justification=c(1,0), 
        legend.position=c(.4,.7))



```

Figure \@ref(fig:dim-mex) compares PISA scores of children of return migrants in Mexico to the local Mexican-born sample using difference-in-means (DIM) and ordinary least squares (OLS). (Coefficients for both OLS models are presented in the Appendix.) The error bars show 95-percent asymptotic confidence intervals. We first consider the DIM estimates, which subtract the average reading, math, or science scores for children of return migrants from the scores for the comparison group. Compared to other adolescents in Mexico, children of return migrants perform somewhat better in all three subjects. The difference amounts to `r with(dim_fig_mex_us, Estimate[sample == 'DIM' & Outcome == 'Reading'])` in reading, `r with(dim_fig_mex_us, Estimate[sample == 'DIM' & Outcome == 'Math'])` in math, and `r with(dim_fig_mex_us, Estimate[sample == 'DIM' & Outcome == 'Science'])` in science. The math advantage is significant and reaches one-fifth of a standard deviation, while the differences are not significant for reading and science. The next set of estimates adjusts for pre-migration characteristics in a linear regression estimated by OLS. The advantage for each score does not diminish and is more precisely estimated. The 0.5 generation performs as well as or better than similar Mexican-born children, especially in math.  

These results are contrary to most previous work on the experiences of children of return migrants: rather than struggling academically, these children are doing as well or better than the general population of Mexican-born children. Hence the data provide partial support for these being "star students": despite the travails of migration, these children are not academically disadvantaged compared to their Mexican peers, attaining somewhat higher scores, at least in math.

The third set of estimates, "OLS (pre- & post-migration)", includes possible post-migration mediators of the advantage possessed by members of the 0.5 generation. These include household wealth; home possessions; home information and communication technology (ICT) resources; an index of economic, social and cultural status; urban or non-urban locality; and highest parental occupational status (in ISEI). The academic advantaged enjoyed by the 0.5 generation does not diminish and is estimated more precisely. These models suggest that material circumstances do not account for these children's higher scores. It seems more likely that cultural and legal advantages of a bicultural education, better resourced U.S. schools, potential dual nationality, and freedom from social markers of difference have provided these children with advantages to succeed in school.  


```{r mod-desc-mex, fig.cap = 'Sample distributions of gender, school location, and age at arrival. The first two panels compare the U.S.-born 0.5 generation to Mexican-born locals, while the third panel shows the distribution only for the 0.5 generation. All estimates incorporate sampling weights.'}
plot_female <- pisa_mex %>%
  group_by(treat) %>%
  count(female, wt = weight) %>%
  mutate(treat = ifelse(treat == 1, "0.5 gen.", "Mexico"),
         female = ifelse(female == 1, 'Female', 'Male')) %>%
  ggplot(aes(x = treat, y = n, fill = female)) +
  geom_bar(position='fill', stat = 'identity') +
  geom_text(aes(label = female), size = 3, 
            position = position_fill(vjust = 0.5), color = 'white') +
  labs(x = '', y = 'Proportion', 
       title = 'Gender') + 
  theme(legend.position = "none")

plot_location <- pisa_mex %>%
  filter(!is.na(school_location)) %>%
  group_by(treat) %>%
  count(school_location, wt = weight) %>%
  mutate(treat = ifelse(treat == 1, "0.5 gen.", "Mexico")) %>%
  ggplot(aes(x = treat, y = n, fill = school_location)) +
  geom_bar(position='fill', stat = 'identity') +
  geom_text(aes(label = school_location), size = 2.5,
            position = position_fill(vjust = 0.5), color = 'white') +
  labs(x = '', y = '', 
       title = 'School Location') + 
  theme(legend.position = "none")

age_arrival_df <- pisa_mex %>%
  filter(treat == 1, !is.na(age_arrival)) %>%
   count(age_arrival, wt = weight) %>%
  mutate(prop = n /sum(.[,'n']))

plot_age_arrival <- age_arrival_df %>%
  ggplot(aes(x = age_arrival, y = prop)) +
  geom_col(width = .99) +
  labs(x = '', y = '', 
       title = 'Age at Arrival')

plot_female + plot_location + plot_age_arrival
```

```{r mod-est-mex-mods}
controls = '+ mom_ed + dad_ed + female + early_ed + cultural_pos + home_ed + age + year'

mod_df_mex_us <- bind_rows(
  rubin(filter(pisa_mex, female == 1), 'Girls', covariates = controls),
  rubin(filter(pisa_mex, female == 0), 'Boys', covariates = controls),
  rubin(filter(pisa_mex, non_urban == 1), 'Non-urban', covariates = controls),
  rubin(filter(pisa_mex, non_urban == 0), 'Urban', covariates = controls),
  rubin(filter(pisa_mex, village == 1), 'Village', covariates = controls),
  rubin(filter(pisa_mex, village == 0), 'Non-village', covariates = controls),
  rubin(filter(pisa_mex, age_arrival < 5 | treat == 0), 'Under 5', covariates = controls),
  rubin(filter(pisa_mex, age_arrival >= 5 | treat == 0), '5 and older', covariates = controls),
  rubin(filter(pisa_mex, age_arrival < 10 | treat == 0), 'Under 10', covariates = controls),
  rubin(filter(pisa_mex, age_arrival >= 10 | treat == 0), '10 and older', covariates = controls)
  # rubin(filter(pisa_mex, private_school == 1), 'Private', covariates = controls),
  # rubin(filter(pisa_mex, private_school == 0), 'Public', covariates = controls)
  # rubin(filter(pisa_mex, parent_ed <= 2), 'Parents w/o HS', covariates = controls),
  # rubin(filter(pisa_mex, parent_ed > 2), 'Parents HS+', covariates = controls),
)



# moderator_p(mod_df_mex_us, 'Girls', 'Boys')
# moderator_p(mod_df_mex_us, 'Non-urban', 'Urban')
# moderator_p(mod_df_mex_us, 'Village', 'Non-village')

```

```{r mod-est-mex, fig.cap = 'Moderators of the difference in PISA scores between 0.5 generation and Mexican-born adolescents. All estimates come from OLS models that adjust for the controls specified in the data section, cluster standard errors at the school level, and incorporate sampling weights.'}
mod_df_mex_us %>% 
  mutate(sample = factor(sample, levels = unique(mod_df_mex_us$sample))) %>%
  ggplot(aes(x = sample, y = Estimate, color = Outcome)) +
  geom_point(position = position_dodge(0.2)) +
  geom_errorbar(aes(ymin = Estimate - 1.96*se, 
                    ymax = Estimate + 1.96*se),
                width = 0, alpha = 1, position = position_dodge(0.2)) +
  geom_hline(yintercept = 0) +
  labs(x = '', y = 'Difference in scores for 0.5 generation'
       #title = 'Across moderators, the 0.5 generation performs as well or better than local Mexican students'
       ) +
  theme(axis.text.x=element_text(angle=-15),
        legend.justification=c(0,0),
        legend.position=c(0.175,.02)) 

```

The next analyses consider possible moderators of these effects. How do results vary by gender, age at migration, and rural or urban locality? Generally, girls tend to surpass boys in school [@buchmann_2008_gender], and the advantage for immigrant girls may be even higher [@dronkers_2014_migrant]. Thus we might expect girls of the 0.5 generation to have an easier time adjusting to academic life in Mexico. The left panel of Figure \@ref(fig:mod-desc-mex) shows that the proportions of girls in the 0.5 generation and local Mexican samples are nearly identical. Does the academic performance of boys and girls of the 0.5 generation differ? The first estimates in Figure \@ref(fig:mod-est-mex) show the difference between girls of 0.5 generation and Mexican-born girls, derived from OLS models with the same pre-migration control variables and standard error procedures as for the full sample above. Corresponding estimates for boys follow. Except for math, the 0.5-generation advantage for girls is greater than that for boys, but differences between genders are not statistically significant. Both groups achieve scores at least as high as those of Mexican-born adolescents.  

Worldwide, PISA scores tend to be lower in rural areas [@sullivan_2018_comparison; @echazarra_2019_learning]. @hamann_2021_what claim that the 0.5 generation is more likely to live in rural areas, where relative paucity of resources may contribute to disadvantage. The final set of estimates in Figure \@ref(fig:dim-mex) shows that including a measure of rurality does not change estimates of overall score disparities. But location could still moderate results. What proportion of the children in this sample live in rural areas, and how does achievement vary between rural and urban areas? PISA categorizes "school community" as village, small town, town, city, or large city. I test two possible dichotimizations: (1) village, small town, and town vs. city or large city, and -- in a stricter test of rural disadvantage -- (2) village vs. the other categories.  

The second panel of Figure \@ref(fig:mod-desc-mex) partially corroborates @hamann_2021_what: the 0.5 generation tends to live in somewhat less urban areas than the general population of Mexican children. However, the  proportions in villages and large cities are virtually identical. Figure \@ref(fig:mod-est-mex) shows that, contrary to expectations, score disparities do not vary by rurality. Point estimates in non-urban, urban, village, and non-village localities do not vary greatly, and differences between them are not statistically significant.  

Finally, I consider age at migration as a potential moderator. @despagne_2019_adaptation suggest that challenges faced by the 0.5 generation tend to fade with time. Furthermore, children who migrate at younger ages tend to score higher on achievement tests [@hermansen_2017_age; @lemmermann_2018_causal]. Are the results reported above due to a large proportion of children who migrated at a young age? The right-most panel in Figure \@ref(fig:mod-desc-mex) shows that the distribution of age at migration is skewed toward the younger years. In fact, a full `r with(age_arrival_df, prop[age_arrival == 0]) * 100` percent of the sample migrated to Mexico before the age of 1. Figure \@ref(fig:mod-est-mex) explores two possible divisions of arrival age, at 5 and 10 years. According to the figure, these age cut-offs do not make a difference. Whether these children migrate at a young or older age, they tend to perform as well or better than locals on PISA tests. This implies that experience in U.S. schools does not necessarily contribute to small advantage enjoyed by 0.5 generation. Overall, results vary little across all moderators tested; the math score advantage remains strong and significant, and point estimates never show a negative disparity for any subject.  


## Comparisons to the U.S. Context

We now turn to comparisons between the 0.5 generation in Mexico and children of Spanish-speaking immigrants in the U.S. This pseudo-control group allows us to address the counterfactual question: what would have happened to these children had they not migrated to Mexico? Put another way, how much have they dissimilated [@fitzgerald_2012_comparativist] from their counterparts in the U.S.? Descriptive statistics in Table \@ref(tab:stats) shows that although the 0.5 generation achieves somewhat higher scores than their Mexican-born peers, the U.S. comparison group performs much higher.  

```{r dim-us, results = 'hide', fig.height = 3.5, fig.cap = "Difference-in-means (DIM) and OLS estimates comparing children of return migrants in Mexico to children of Spanish-speaking immigrants in the U.S. Error bars represent 95% asymptotic confidence intervals. OLS (pre-migration) models adjust for parents' education, cultural possessions, home educational resources, age, ECEC, gender, and survey year. OLS (post-migration) models additionally adjust for household wealth; home possessions; home ICT resources; an index of economic, social and cultural status; urban or non-urban locality; and highest parental ISEI. All models cluster standard errors at the school level and incorporate sampling weights."}
dim_fig_us <-
  bind_rows(rubin(pisa_mex_us, 'DIM', weights = 'senate_weight'),
          rubin(pisa_mex_us, 'OLS (pre-migration)', 
                'mom_ed + dad_ed + female + early_ed +cultural_pos + home_ed + age + year',
                weights = 'senate_weight'),
          rubin(pisa_mex_us, 'OLS (pre- & post-migration)',
                covariates = 'mom_ed + dad_ed + female + early_ed +
                cultural_pos + home_ed + age + year + 
                wealth + home_pos + ict_res + escs + parent_isei', 
                weights = 'senate_weight')
          ) %>%
  mutate(Outcome = recode_factor(Outcome,
                                 'read' = 'Reading',
                                 'math' = 'Math',
                                 'scie' = 'Science'),
            sample = factor(sample, 
                            levels = c('DIM', 'OLS (pre-migration)', 'OLS (pre- & post-migration)')))

dim_fig_us %>%
  ggplot(aes(x = sample, y = Estimate, color = Outcome)) +
  geom_point(position = position_dodge(0.2)) +
  geom_errorbar(aes(ymin = Estimate - 1.96*se, ymax = Estimate + 1.96*se),
                width = 0, alpha = 1, position = position_dodge(0.2)) +
  geom_hline(yintercept = 0) +
  labs(x = 'Method', y = '') +
  theme(#axis.text.x=element_text(angle=-15),
        legend.justification=c(1,0), 
        legend.position=c(.45,.05))
```

Figure \@ref(fig:dim-us) presents the disparities. Unadjusted difference-in-means estimates show stark negative differences: `r with(dim_fig_us, Estimate[sample == 'DIM' & Outcome == 'Reading'])` in reading, `r with(dim_fig_us, Estimate[sample == 'DIM' & Outcome == 'Math'])` in math, and `r with(dim_fig_us, Estimate[sample == 'DIM' & Outcome == 'Science'])` in science. These amount to the 0.5 generation achieving math scores one-fifth of a standard deviation lower than their U.S. counterparts, and reading and science disparities are closer to half of a standard deviation. Despite being star students in Mexico, these children struggle on PISA exams much more than children of Spanish-speaking immigrants in the U.S. (Coefficients for both OLS models are presented in the Appendix.)  


```{r mex-us-compare, fig.cap = 'Histograms comparing the family background of 0.5 generation to the chilren of Spanish-speaking immigrants in the U.S. in PISA 2012, 2015, and 2018. Estimates incorporate sampling weights.'}
plot_cat <- function(var_name, title){
  pisa_mex_us %>%
      mutate(treat = ifelse(treat == 1, '0.5 Generation', 'U.S. Spanish-Speaking')) %>%
      filter(!is.na(!!sym(var_name))) %>%
      group_by(treat, !!sym(var_name)) %>%
      count(wt = senate_weight) %>%
      group_by(treat) %>%
      mutate(prop = n /sum(n)) %>%
      ggplot(aes(x = !!sym(var_name), y = prop, color = treat, fill = treat)) +
      geom_col(position = 'dodge') +
      labs(x = '', y = '', 
           title = title)
}

plot_cont <- function(var_name, title){
   pisa_mex_us %>%
      mutate(treat = ifelse(treat == 1, '0.5 Generation', 'U.S. Spanish-Speaking')) %>%
      ggplot(aes(x = !!sym(var_name), color = treat, fill = treat)) +
      geom_histogram(aes(y=..density..,
                     weight = senate_weight),
                     position = 'dodge') +
  labs(x = '', y = '', title = title)
}

plot_cat('early_ed', 'Early Childhood Education') + 
  plot_cat('parent_ed_years', "Parent's Years of Education") + 
  scale_x_continuous(breaks = unique(pisa_mex_us$parent_ed_years)) +
  plot_cont('wealth', 'Wealth Composite')  +
  plot_cont('parent_isei', 'Parent\'s Occupation (ISEI)') + 
  plot_layout(nrow = 2, guides = 'collect')  & theme(legend.position = 'bottom')


years_df <- as_survey_design(pisa_mex_us, ids = school_id, weights = 'senate_weight') %>%
  group_by(treat) %>%
  summarize(survey_mean(parent_ed_years))

isei_df <- as_survey_design(pisa_mex_us, ids = school_id, weights = 'senate_weight') %>%
  group_by(treat) %>%
  summarize(survey_mean(parent_isei, na.rm = T))
```

Are such large disparities due to selection into migration? Figure \@ref(fig:mex-us-compare) compares histograms of family attributes of the two samples. The top row shows two measures of pre-migration characteristics. First, the 0.5 generation is more likely to have been enrolled in early childhood education, and for longer. The top right panel compares  parents' highest years of education, showing that the 0.5 generation thends to have a parent with more years of education -- `r years_df[2,2]` years compared to the comparison group's `r years_df[1,2]` -- and also more likely to have a parent with a college degree. In this sense, the 0.5 generation appears to be *positively selected*: they benefit from greater personal and family educational advantages than their counterparts who remain in the U.S. This is at odds with previous research that showed negative selection in the general return migrant population [@campos-vazquez_2012_selfselection].   
<!-- At the same time, these children are also more likely to have a parent with less than a high school education. -->

Hence we would expect that controlling for pre-migration characteristics will *not* account for disparities in PISA scores. Indeed, as shown in Figure \@ref(fig:dim-us), an OLS model that adjusts for these characteristics estimates slightly smaller gaps, but they remain for all three subjects.  

Since selection into migration on these measured characteristics does not account for disparities, could the post-migration experience play a role? The second row of Figure \@ref(fig:mex-us-compare) presents two measures of post-migration attributes. The bottom-left panel shows a composite measure of family wealth, based on household possessions. Despite their pre-migration advantages, the 0.5 generation has less material assets than the U.S. comparison group. The bottom-right panel presents the parents' highest ISEI. The parents of the 0.5 generation are somewhat more likely to be employed in more prestigious, less manual labor. The educational advantage enjoyed by parents of the 0.5 generation carries over to their occupation in Mexico, but it does not translate to comparable measures of wealth.  

The final set of estimates in Figure \@ref(fig:dim-us) adjusts for pre- and post-migration characteristics. Estimated disparities become even more negative, although they are not significantly different from the DIM estimates. This suggests that it is neither selection nor the post-migration material experience of the 0.5 generation that accounts for their lower achievement compared to the U.S. Rather, it is likely that the lower resources of Mexican schools as well as the stress of adapting to an unfamiliar society are the contributing factors.  

```{r mod-est-us-mods}
controls = 'mom_ed + dad_ed + female + early_ed + cultural_pos + home_ed + age + year'

mod_df_us <- bind_rows(
  rubin(filter(pisa_mex_us, female == 1), 'Girls', covariates = controls),
  rubin(filter(pisa_mex_us, female == 0), 'Boys', covariates = controls),
  rubin(filter(pisa_mex_us, non_urban == 1), 'Non-urban', covariates = controls),
  rubin(filter(pisa_mex_us, non_urban == 0), 'Urban', covariates = controls),
  rubin(filter(pisa_mex_us, village == 1), 'Village', covariates = controls),
  rubin(filter(pisa_mex_us, village == 0), 'Non-village', covariates = controls),
  rubin(filter(pisa_mex_us, age_arrival < 5 | treat == 0), 'Under 5', covariates = controls),
  rubin(filter(pisa_mex_us, age_arrival >= 5 | treat == 0), '5 and older', covariates = controls),
  rubin(filter(pisa_mex_us, age_arrival < 10 | treat == 0), 'Under 10', covariates = controls),
  rubin(filter(pisa_mex_us, age_arrival >= 10 | treat == 0), '10 and older', covariates = controls)
  # rubin(filter(pisa_mex_us, private_school == 1), 'Private', covariates = controls),
  # rubin(filter(pisa_mex_us, private_school == 0), 'Public', covariates = controls)
)

# moderator_p(mod_df_us, 'Girls', 'Boys')
# urban_us_p <- moderator_p(mod_df_us, 'Non-urban', 'Urban')[,4]
# village_us_p <- moderator_p(mod_df_us, 'Village', 'Non-village')[,4]

non_urban_df <- rubin_means(filter(pisa_mex_us, non_urban == 1), labels = c('Mexico', 'U.S.'))
urban_df <- rubin_means(filter(pisa_mex_us, non_urban == 0), labels = c('Mexico', 'U.S.'))
# rubin_means(pisa_mex_us, labels = c('Mexico', 'U.S.')) 
```

```{r mod-est-us, fig.cap = 'Moderators of the difference in PISA scores between 0.5 generation and children of Spanish-speaking immigrants in the U.S. All estimates come from OLS models that adjust for the controls specified in the data section, cluster standard errors at the school level, and incorporate sampling weights.'}
mod_df_us %>% 
  mutate(sample = factor(sample, levels = unique(mod_df_us$sample))) %>%
  ggplot(aes(x = sample, y = Estimate, color = Outcome)) +
  geom_point(position = position_dodge(0.2)) +
  geom_errorbar(aes(ymin = Estimate - 1.96*se, 
                    ymax = Estimate + 1.96*se),
                width = 0, alpha = 1, position = position_dodge(0.2)) +
  geom_hline(yintercept = 0) +
  labs(x = '', y = 'Difference in scores for 0.5 generation'
       #title = 'Across moderators, the 0.5 generation in Mexico underperforms compared to their U.S. counterparts'
       ) +
  theme(axis.text.x=element_text(angle=-15),
        legend.justification=c(0,0),
        legend.position=c(0.175,.02)) 
```

The final set of analyses examines factors that moderate the effect of migration. Figure \@ref(fig:mod-est-us) presents the same set of moderators as Figure \@ref(fig:mod-est-mex), fitting the "OLS (pre-migration)" model to subsets of the data. First, effects differ little by gender: girls and boys in the 0.5 generation in Mexico achieve lower scores than daughters and sons of Spanish-speaking immigrants in the U.S., respectively, and differences between them are not statistically significant.  

The urban-rural divide shows greater disparities, corroborating the expectations of @hamann_2021_what regarding the potential disadvantage of rural areas. The 0.5 generation in non-urban areas obtains PISA scores that are significantly lower than their non-urban U.S. counterparts. Restricting the sample to residents of villages reveals even starker disparities: estimated reading and science scores are more than one standard deviation below their U.S. counterparts in rural areas, and math scores lie half of a standard deviation below. On the other hand, expected PISA scores for the 0.5 generation in Mexican urban areas are indistinguishable from their urban counterparts in the U.S. This is not due to U.S.-specific urban disadvantage; in the U.S., children of Spanish-speaking immigrants in urban areas perform better than those in rural areas.^[For example, children of Spanish-speaking immigrants in urban areas obtain an average of `r urban_df$Mean[urban_df$Outcome == 'Math' & urban_df$label == 'U.S.']` on math tests, while the average for those in non-urban areas is `r non_urban_df$Mean[urban_df$Outcome == 'Math' & urban_df$label == 'U.S.']`.] This contrasts the findings from the Mexico comparisons above: although the 0.5 generation does not perform worse that similar Mexican children living in the same type of locality, students in rural areas in Mexico face significant disadvantage compared to their counterparts in rural areas in the U.S.  

Finally, we see little variation in effect by age of migration. If we restrict the analysis to children who migrated to Mexico below the age of 5 or 10, estimated disparities are just as negative as for children who migrated at older ages. Students in Mexican schools obtain lower PISA scores that children in the U.S.  



## Sensitivy Analysis

Results may be sensitive to choice of estimation strategy or omission of a confounding variable. To assess the robustness of results, this section presents results from alternative estimation techniques. The Appendix also analyses the sensitivity of results to omitted confounders, finding that disparities between the 0.5 generation and children of Spanish-speaking immigrants in the U.S. are fairly robust to high levels of potential confounding.  

```{r alt-mods}
controls <- "mom_ed + dad_ed + female + early_ed + cultural_pos + home_ed + age + year"

# cem_mx1 <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
#                             cultural_pos + home_ed + age + year,
#                             data = pisa_mex,
#                             method = 'cem',
#                             s.weights = pisa_mex$weight)
# 
# cem_mx2 <- MatchIt::matchit(treat ~ parent_ed + female + early_ed +
#                             cultural_pos + home_ed + age + year,
#                             data = pisa_mex,
#                             method = 'cem',
#                             s.weights = pisa_mex$weight,
#                             cutpoints = list(parent_ed = 3)) 

psm_mx <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex,
                           method = 'nearest',
                           distance = 'glm',
                           s.weights = pisa_mex$weight) 

mahvars_mx <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex,
                           method = 'nearest',
                           distance = 'mahalanobis',
                           s.weights = pisa_mex$weight) 

full_mx <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex,
                           method = 'full',
                           s.weights = pisa_mex$weight) 

# IPW
pi.out = glm(treat ~ mom_ed + dad_ed + female + early_ed +
               cultural_pos + home_ed + age + year,
             data = pisa_mex,
             family="binomial"(link=logit))
ps = pi.out$fit
D = pisa_mex$treat
PrD = mean(D)
IPW_mex = (D*PrD+(1-D)*(1-PrD))/(D*ps+(1-D)*(1-ps))

# plot(density(pi.out$fit[D==1], weight=IPW[D==1]/sum(IPW[D==1])), lwd=2, main="Distribution of pscores: Weighted")
# lines(density(pi.out$fit[D==0], weight=IPW[D==0]/sum(IPW[D==0])),lwd=2, lty=2)
# legend("topright", legend=c("treated","controls"), lty=c(1,2), lwd=2)


          
alt_fig_mex <- bind_rows(
  rubin(pisa_mex, 'OLS', controls),
  rubin(match.data(psm_mx), 'PSM', weights = 'weights'),
  rubin(match.data(mahvars_mx), 'Mahalanobis', weights = 'weights'),
  rubin(match.data(full_mx), 'Optimal Full', weights = 'weights'),
  rubin(pisa_mex, 'IPW', weights = IPW_mex))


# cem_us1 <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
#                             cultural_pos + home_ed + age + year,
#                             data = pisa_mex_us,
#                             method = 'cem',
#                             s.weights = pisa_mex_us$weight)
# cem_us_data1 <- MatchIt::match.data(cem_us1)
# 
# cem_us2 <- MatchIt::matchit(treat ~ parent_ed + female + early_ed +
#                             cultural_pos + home_ed + age + year,
#                             data = pisa_mex_us,
#                             method = 'cem',
#                             s.weights = pisa_mex_us$weight,
#                             cutpoints = list(parent_ed = 3)) 
# cem_us_data2 <- MatchIt::match.data(cem_us2)

psm_us <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex_us,
                           method = 'nearest',
                           distance = 'glm',
                           s.weights = pisa_mex_us$weight)

mahvars_us <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex_us,
                           method = 'nearest',
                           distance = 'mahalanobis',
                           s.weights = pisa_mex_us$weight) 

full_us <- MatchIt::matchit(treat ~ mom_ed + dad_ed + female + early_ed +
                           cultural_pos + home_ed + age + year,
                           data = pisa_mex_us,
                           method = 'full',
                           s.weights = pisa_mex_us$weight) 

pi.out = glm(treat ~ mom_ed + dad_ed + female + early_ed +
               cultural_pos + home_ed + age + year,
             data = pisa_mex_us,
             family="binomial"(link=logit))
ps = pi.out$fit
D = pisa_mex_us$treat
PrD = mean(D)
IPW_us = (D*PrD+(1-D)*(1-PrD))/(D*ps+(1-D)*(1-ps))

alt_fig_us <- bind_rows(
  rubin(pisa_mex_us, 'OLS', controls),
  rubin(match.data(psm_us), 'PSM', weights = 'weights'),
  rubin(match.data(mahvars_us), 'Mahalanobis', weights = 'weights'),
  rubin(match.data(full_us), 'Optimal Full', weights = 'weights'),
  rubin(pisa_mex_us, 'IPW', weights = IPW_us))


alt_fig <- bind_rows(
    mutate(alt_fig_mex, country = 'Mexico'), 
    mutate(alt_fig_us, country = 'U.S.')) %>%
  mutate(Outcome = recode_factor(Outcome,
                                 'read' = 'Reading',
                                 'math' = 'Math',
                                 'scie' = 'Science'),
           sample = factor(sample,
                           levels = c('OLS', 'PSM', 'Mahalanobis', 'Optimal Full', 'IPW')))
```

```{r alt-mods-fig, results = 'hide', fig.height = 3.5, fig.cap = "Alternate estimates comparing children of return migrants in Mexico to children in Mexico and children of Spanish-speaking immigrants in the U.S. Error bars represent 95% asymptotic confidence intervals. Models adjust for parents' education, cultural possessions, home educational resources, age, ECEC, gender, and survey year. OLS is the baseline model, PSM uses propensity score matching, matches on Mahalnobis distance, Optimal Full implements the matching algorithm from Hansen and Klopfer (2006), and IPW incorporates (stabilized) inverse propbability weights."}
alt_fig %>%
  ggplot(aes(x = sample, y = Estimate, color = Outcome)) +
  geom_point(position = position_dodge(0.2)) +
  geom_errorbar(aes(ymin = Estimate - 1.96*se, ymax = Estimate + 1.96*se),
                width = 0, alpha = 1, position = position_dodge(0.2)) +
  geom_hline(yintercept = 0) +
  facet_wrap(~country) +
  labs(x = '', y = 'Estimated difference in PISA score') +
  theme(axis.text.x=element_text(angle=-15),
        legend.justification=c(1,0), 
        legend.position=c(1,.6))



```

Figure \@ref(fig:alt-mods-fig) presents five types of estimates of the effect of being in the 0.5 generation. The left panel corresponds to the comparisons with Mexican-born adolescents from Figure \@ref(fig:dim-mex), and the right panel is related to Figure \@ref(fig:dim-us) and compares with children of Spanish-speaking immigrants in the U.S. The estimates labeled "OLS" reproduce the results for "OLS (pre-migration)" from those figures, and the other estimates test the robustness of this baseline estimate. The next three sets of estimates use forms from the MatchIt package [@ho_2011_matchit]. "PSM" and "Mahalanobis" present estimates 1:1 matching for propensity scores estimated from logistic regression [@rosenbaum_1983_central] and Mahalanobis distance, respectively. "Optimal Full" employs optimal full matching [@hansen_2006_optimal], which places all units into subclasses in order to minimize the sum of absolute within-subclass distances. Finally, "IPW" uses stabilized inverse probability weights [@austin_2015_moving, p. 3663], performing bivariate weighted OLS regressions with the full samples.   

Estimates are highly robust to choice of estimator. Across all specifications, the U.S.-born 0.5 generation outperforms Mexican-born locals in math, and they score lower across all subjects when compared to children of Spanish-speaking immigrants in the U.S.


<!-- "CEM 1" and "CEM 2" both use coarsened exact matching [@iacus_2012], reducing the complexity of variables by sorting them into a finite number of "bins" and then matching exactly on these. Any case that cannot be matched exactly on these coarsened variables is dropped. "CEM 1" uses the same matching variables as the OLS models, while "CEM 2" prevents dropping as many cases by combining parents' education into a single dichotomous variable taking the value of 1 if either parent has a high school degree and 0 if neither does.  -->




# Discussion and Conclusion

This paper aimed to quantify the educational situation of U.S.-born children of return migrants in Mexico. Previous research on this "0.5 generation" [@zuniga_2018_ninas] has presented a mixed picture: although these children face stigma, language difficulties, and bureaucratic hurdles [@gonzalez_2016_moving; @despagne_2019_adaptation; @zuniga_2018_generation; @gandara_2020_students; @mateos_2019_mestizo], some scholars have documented the advantages bestowed by bicultural facility and time in relatively well resourced U.S. schools, at least for some of these students [@zuniga_2018_ninas; @bybee_2020_estamos; @hernandez-leon_2020_imperfect]. To help settle this empirical question, I presented two types of comparisons using PISA data. First, in the tradition of assimilation and integration studies, I compared the 0.5 generation to the general population of Mexican 15-year-olds. Second, I compared these adolescents to a pseudo-control group: children of Spanish-speaking immigrants in the U.S. While the first comparison presents the descriptive perspective of Mexican society, the second gets closer to estimating a causal effect of migration, or the scores that these students would have obtained had their families not returned to Mexico. In addition, models that control for pre-migration attributes allow explicit examination of the effect of immigrant selection. By considering two countries in cross-border perspective [@waldinger_2017_crossborder], this paper yields deeper insights than analyses bounded by a single national unit.    

In the comparisons with Mexican children, I find few disparities: U.S.-born children of return migrants perform just as well as Mexican children on reading and science PISA tests, and they outperform locals in math by one-fifth of a standard deviation. These effects remain nearly unchanged in models that control for both pre- and post-migration attributes, and the potential moderators of gender, urban or rural locality, and age at migration make little difference. Comparisons with the U.S. sample, however, tell a story of disadvantage. Juxtaposed with this pseudo-control group, children of Mexican return migrants obtain much lower scores, ranging from one-quarter to one-half of a standard deviation. Contrary to general work on Mexican return migrants, the parents of these adolescents are positively selected on education and work in slightly more prestigious occupations than their U.S. counterparts. Controlling for pre- or post-migration family characteristics does little to change effect estimates.  

<!-- This paper also offers a commentary on assimilation theory. Assimilation theory has been largely absent from discussion of return migration, and yet it is put into question by the 0.5 generation.  -->
Children of return migrants test the boundary of the immigrant category. Despite their nominal status as immigrants, these adolescents speak Spanish, appear ethnically Mexican, and have immediate access to citizenship. Theories of assimilation suggest that without legal and cultural barriers, assimilation should proceed quickly and smoothly [@alba_2003_remaking; @portes_1993_new]. And this is what this study finds: the 0.5 generation's academic achievement is very similar to the Mexican mainstream's. So why does most previous qualitative work on the 0.5 generation document significant struggles in school? A likely answer is the choice of reference group.  

The cross-border perspective places achievement in an international context, taking the perspective of the immigrants themselves. Moving from the U.S. to Mexico appears to negatively impact the achievement of the 0.5 generation, so it is no surprise that researchers working closely with these students document challenges and struggles; from the perspective of the students themselves, they are struggling compared to the friends they left behind. Assimilation does proceed smoothly, but its endpoint is the relatively low educational average of Mexican schools, which receive far fewer resources than those in the U.S. [@santibanez_2021_contrasting]. These findings highlight the importance that institutional context plays in the incorporation process.  
<!-- Much lower per-student funding, a short school day, and over-extended teachers mean that U.S.-born migrants quickly fall behind their peers to the north [@santibanez_2021_contrasting]. -->
<!-- As Santibañez [-@santibanez_2021_contrasting, p. 23] writes, "even the richest students in Mexico score only slightly higher on the international PISA test than the poorest students in the United States."   -->
<!-- What is of tantamount importance here is not the immigrants themselves -- indeed, their individual characteristics play little role in moderating their achievement -- but instead the education system in which they find themselves.   -->
<!-- As Santibañez [-@santibanez_2021_contrasting, p. 23] writes, "even the richest students in Mexico score only slightly higher on the international PISA test than the poorest students in the United States."  -->
<!-- Although the bottom-left panel of Figure \@ref(fig:mex-us-compare) suggests that the 0.5 generation is more materially deprived than similar youths in the U.S., models that control for family wealth estimate larger rather than smaller disparities.  -->

Yet the 0.5 generation retains a small advantage -- at least in math achievement -- compared to Mexican-born students. This may result from the bicultural resources or prestige bestowed by experience in the U.S. Alternatively, facility with standardized tests, which are much more common in the U.S. than Mexico, may enable their success in PISA, regardless of actual learning. These children may also benefit from resources they or their families have obtained during their time abroad [@clemens_2008_income]; the positive selection of their parents supports this conclusion. A more sobering possibility is that bureaucratic hurdles prevent the most disadvantaged students from enrolling in school [@mateos_2019_mestizo] or they have dropped out completely [@zuniga_2020_migracion]; in either case they are excluded from the PISA sample. Further research is needed to explore these possibilities.

This study suggests a number of future directions for research on the 0.5 generation. First, this study has not been able to differentiate between voluntary and involuntary return migration. The threat of deportation has been shown to negatively impact student achievement [@gandara_2021_schools], and deportation itself is likely to have even more negative effects; future work should attempt to differentiate the effects of different types of return. Second, qualitative studies of the Mexican 0.5 generation have often pooled together students born in the U.S. and those born in Mexico who migrate to the U.S. at an early age [@zuniga_2018_generation; @zuniga_2018_ninas; @zuniga_2021_children]. Although identifying the latter is not possible in PISA data, future research should assess the achievement of this group as well. Lastly, since PISA is administered only to 15-year-olds, we do not know if achievement varies by age at test time. Previous work has shown that disparities for children of immigrants may be greater at younger ages [@hoffmann_2018_cognitive; @strand_2015_english], and educational parity at older ages may not translate to equality in the labor market [@lee_2021_asian, p. 192-193]. Future research should investigate achievement at younger ages as well as the school-to-work transition for the 0.5 generation.  

This study constitutes an important corrective to literature on U.S.-born children of return migrants in Mexico. First, by showing that the educational situation of these students is one of advantage rather than disadvantage when compared to other students in Mexico, this study contradicts much previous research on this group that depicts these students as strangers in the homeland who struggle academically. Second, this paper shows that studies that focus on only one country fail to capture the importance of institutional context. The U.S. comparisons presented here show that migration from more- to less-advantaged educational contexts can entail unfortunate consequences for children's educational outcomes. Since many of these returns result from deportation of parents, this paper documents yet another way that U.S.-citizen children of undocumented immigrants are harmed by punitive immigration policy. 


<!-- We see that, indeed, these adolescents struggle in school relative to their peers in the U.S. Yet what appears to be  -->
<!-- PISA excludes 15-year-olds who have been unable to enroll in school, and these may be among the most disadvantaged of the 0.5 generation. -->
<!-- Differences from previous studies could be due to a number of reasons that future research should attempt to disentangle. -->

\beginsupplement
# (APPENDIX) Appendix {-}

# Appendix

## Full Regression Tables 

```{r functions-supp}

library(stargazer) 

rubin_lm <- function(dataset, covariates, pv_num = 5, 
                  treat = 'treat', weights = 'weight', cluster_var = 'school_id'){
  dataset = as.data.frame(dataset)
  lm_list <- list()
  se_list <- list()
  
  for(outcome in c('read', 'math', 'scie')){
    est_ols <- list()
    var_ols <- list()
    
    for(pv in 1:pv_num){
      formula <- paste0(outcome, pv, ' ~ ', treat, ' + ', covariates)
      lm_model <- lm(formula, data = dataset, weights = weight)
      est_ols[[pv]] <- tidy(lm_model)$estimate
      var_ols[[pv]] <- diag(vcovCL(lm_model, cluster = dataset[, cluster_var]))
      names(est_ols[[pv]]) <- names(var_ols[[pv]])
      #var_ols[pv] <- vcovHC(lm_model, type="HC1")[2,2]
    }
    est_out_ols <- rowMeans(simplify2array(est_ols))
    var_samp_ols <- rowMeans(simplify2array(var_ols))
    var_imp_ols <- lapply(est_ols, function(x){(x - est_out_ols)^2}) %>%
      simplify2array() %>%
      rowSums()/4
    se_out_ols <- sqrt(var_samp_ols + (1 + 1/5)*var_imp_ols)
    
    lm_final <- lm(reformulate(covariates, paste0(outcome,1)), 
                   data = dataset, weights = weight)
    lm_final$coefficients <- est_out_ols
    
    lm_list[[outcome]] <- lm_final
    se_list[[outcome]] <- se_out_ols
  }
    return(list(estimates = lm_list, se_cluster = se_list))
}

```

```{r models-mex, results = 'asis'}
ols_mex_pre <- rubin_lm(pisa_mex, 'mom_ed + dad_ed + female + early_ed +cultural_pos + home_ed + age + year')


ols_mex_post <- rubin_lm(pisa_mex, 'mom_ed + dad_ed + female + early_ed +
                cultural_pos + home_ed + age + year + non_urban +
                wealth + home_pos + ict_res + escs + parent_isei')

stargazer(c(ols_mex_pre$estimates, ols_mex_post$estimates),
          header = F,
          se = c(ols_mex_pre$se_cluster, ols_mex_post$se_cluster),
          keep.stat = c('n'),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          star.char = c('†', '*', '**', '***'),
          no.space = T,
          dep.var.labels.include = F,
          column.labels = rep(c('Reading', 'Math', 'Science'), 2),
            notes = c("\\parbox[t]{.8\\textwidth}{\\textit{Note}: †\\textit{p}<0.1; *\\textit{p}<0.05; **\\textit{p}<0.01; ***\\textit{p}<0.001. OLS estimates comparing children of return migrants in Mexico to children in Mexico. All models cluster standard errors at the school level and incorporate sampling weights.}", 
                    "\\textit{Source}: PISA data from 2012, 2015, and 2018"), 
          notes.label = '',
          notes.align = 'l',
          notes.append = F,
          font.size = 'footnotesize',
          table.placement = "H",
          label = 'tab:models-mex',
          title = 'Full table of OLS coefficients for Mexican sample')

```


```{r models-us, results = 'asis'}
ols_us_pre <- rubin_lm(pisa_mex_us, 'mom_ed + dad_ed + female + early_ed +cultural_pos + home_ed + age + year')


ols_us_post <- rubin_lm(pisa_mex_us, 'mom_ed + dad_ed + female + early_ed +
                cultural_pos + home_ed + age + year + non_urban +
                wealth + home_pos + ict_res + escs + parent_isei')

stargazer(c(ols_us_pre$estimates, ols_us_post$estimates),
          header = F,
          se = c(ols_us_pre$se_cluster, ols_us_post$se_cluster),
          keep.stat = c('n'),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          star.char = c('†', '*', '**', '***'),
          no.space = T,
          dep.var.labels.include = F,
          column.labels = rep(c('Reading', 'Math', 'Science'), 2),
            notes = c("\\parbox[t]{.8\\textwidth}{\\textit{Note}: †\\textit{p}<0.1; *\\textit{p}<0.05; **\\textit{p}<0.01; ***\\textit{p}<0.001. OLS estimates comparing children of return migrants in Mexico to children of Spanish-speaking immigrants in the U.S. All models cluster standard errors at the school level and incorporate sampling weights.}", 
                    "\\textit{Source}: PISA data from 2012, 2015, and 2018"), 
          notes.label = '',
          notes.align = 'l',
          notes.append = F,
          font.size = 'small',
          table.placement = "H",
          label = 'tab:models-us',
          title = 'Full table of OLS coefficients for U.S. sample')

```





## Sensitivy to Unobserved Confounders

Important variables might be correlated with both immigration (and return migration) as well as test scores. For the Mexican comparison, results are already close to 0, so this section focuses on the U.S. comparison. How strong would an unobserved confounder need to be in order to create a null effect for migration to Mexico for the 0.5 generation? I use the omitted variable bias (OVB) analysis tools of the `sensemakr` package [@cinelli_2020_making] to help answer this question.  



```{r sens, results = 'asis', fig.cap = 'Contour plot of possible confounders of reading scores for the U.S. comparison. Contour lines represent t-values for the return migration coefficient in an OLS model for reading scores with eight additional covariates and hypothetical levels of confounding. "Unadjusted" shows the t-value of the immigration coefficient with no confounding. "10x parents\' ed." shows the t-value of the immigration coefficient after accounting for a hypothetical confounder ten times as strong as the join effects of parents\' education.'}

sens_out <- sensemakr(model = lm('read1 ~ treat + mom_ed + dad_ed + female + early_ed +
                                 cultural_pos + home_ed + age + year', data = pisa_mex_us),
                         data = pisa_mex_us,
                         treatment = "treat",
                         benchmark_covariates = list("parents' ed." = c('mom_ed', 'dad_ed')),
                         kd = 10)
plot(sens_out, sensitivity.of = 't-value')
```

```{r sens-tab, results = 'asis', eval = F}
ovb_minimal_reporting(sens_out, format = "latex", label = 'tab:sens-tab',
                      caption = "Omitted Variable Bias Minimal Reporting Table")

```


I find that an unobserved confounder would need to explain more than `r round(sens_out$sensitivity_stats$rv_q * 100, 1)` percent of the residual variance of both return migration and reading scores in order to bring the estimate of immigration down to 0. Figure \@ref(fig:sens) shows that a confounder even ten times as strong as the joint effect of mother's and father's education would still not produce an insignificant coefficient. The t-value in the original model is `r round(sens_out$sensitivity_stats$t_statistic, 1)`. This plot shows that a confounder even five times as strong as mother's education (`mom_ed`) would only reduce this t-value to `r round(sens_out$bounds$adjusted_t, 1)`, still significant at the $\alpha = 5$ percent level. Results are similar for science and math scores. 



```{r cluster, eval = F}
set.seed(1859)
kmeans_dat <- pisa_mex %>% 
  filter(treat == 1) %>% 
  mutate(early_ed_0 = ifelse(early_ed == 'No', 1, 0)) %>%
  select(mom_ed, dad_ed, cultural_pos, home_ed
        ) %>%
  scale()

kmeans_2 <- kmeans(kmeans_dat, centers = 2)
kmeans_2$centers

k.max <- 10
wss <- sapply(1:k.max, 
              function(k){kmeans(kmeans_dat, k, nstart=50, iter.max = 15)$tot.withinss})
wss
plot(1:k.max, wss,
     type="b", pch = 19, frame = FALSE, 
     xlab="Number of clusters K",
     ylab="Total within-clusters sum of squares")

kmeans_3 <- kmeans(kmeans_dat, centers = 3)
kmeans_3$centers

pisa_mex %>%
  filter(treat == 1) %>%
  mutate(cluster = kmeans_2$cluster) %>%
  group_by(cluster) %>%
  summarize(read = mean(read1), math = mean(math1), scie = mean(scie1))

pisa_mex %>%
  filter(treat == 1) %>%
  mutate(cluster = kmeans_3$cluster) %>%
  group_by(cluster) %>%
  summarize(read = mean(read1), math = mean(math1), scie = mean(scie1))

pisa_mex %>%
  filter(treat == 0) %>%
  summarize(read = mean(read1), math = mean(math1), scie = mean(scie1))
```

\newpage

# References
